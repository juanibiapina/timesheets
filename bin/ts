#!/usr/bin/env bash

if [[ -z "$TS_HOME" ]]; then
  export TS_HOME="$HOME/.ts"
fi

mkdir -p "$TS_HOME"

current_time=`date "+%H %M"`
current_date=`date "+%m-%d-%Y"`
log_file="$TS_HOME/log-$current_date"

if [ "$#" -eq 0 ]; then
  echo "$current_time"
  echo "$current_time" >> "$log_file"
fi

if [ "$1" = "now" ]; then
  joined=`sed '$!N;s/\n/ /' "$log_file"`
  total=0

  while read start_hour start_minute end_hour end_minute
  do
    if [ -z "$end_hour" ]; then
      end_hour=`date +%H`
    fi
    if [ -z "$end_minute" ]; then
      end_minute=`date +%M`
    fi
    minutes=$(((60-10#$start_minute+10#$end_minute)+((10#$end_hour-10#$start_hour-1)*60)))
    total=$(($minutes+total))
  done <<< "$joined"

  total_hours=$(($total/60))
  total_minutes=$(($total%60))
  printf "%02d:%02d\n" "$total_hours" "$total_minutes"
fi
